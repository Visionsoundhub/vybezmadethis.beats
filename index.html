<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Beat Gallery</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Segoe+UI:wght@700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    /* --- General Body & Layout --- */
    * {
        box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      overflow-x: hidden;
      background-color: #0f0f0f;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top, #292929, #0f0f0f 85%), url('https://www.transparenttextures.com/patterns/stardust.png');
      background-repeat: repeat;
      color: #eee;
      padding-bottom: 100px; /* Space for the sticky player on desktop */
    }

    /* --- Top Bar (Search & Vibe) --- */
    .top-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1rem;
        gap: 1rem;
        flex-wrap: wrap;
    }
    .search-container {
      flex-grow: 1;
      display: flex;
      justify-content: center;
    }
    #search-input {
      width: 100%;
      max-width: 480px;
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      border: 1px solid #555;
      background-color: #222;
      color: #fff;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }
    #search-input::placeholder {
      color: #888;
    }
    #search-input:focus {
      border-color: #7e57c2;
      box-shadow: 0 0 15px rgba(126, 87, 194, 0.5);
    }
    #vibe-search-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        background: linear-gradient(145deg, #7e57c2, #42a5f5);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 700;
        font-family: 'Segoe UI', sans-serif;
        transition: all 0.3s ease;
    }
    #vibe-search-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(126, 87, 194, 0.7);
    }


    /* --- Category Filters --- */
    .category-filter {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem;
      padding-top: 0;
    }
    .filter-btn {
      font-family: 'Segoe UI', sans-serif;
      font-weight: 700;
      font-size: 0.85rem;
      white-space: nowrap;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      border: 2px solid transparent;
      cursor: pointer;
      color: #e0e0e0;
      background: linear-gradient(145deg, #656565, #333333);
      transition: all 0.2s ease-in-out;
      box-shadow: inset 0px 1px 1px rgba(255, 255, 255, 0.1), 0 2px 4px rgba(0,0,0,0.5);
    }
    .filter-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      background: linear-gradient(145deg, #777777, #444444);
    }
    .filter-btn.active {
      border-color: #fff;
      color: #111;
      background: linear-gradient(145deg, #d5d5d5, #a0a0a0);
      box-shadow: inset 0px 1px 2px rgba(0, 0, 0, 0.2);
    }

    /* --- Info Boxes --- */
    .info-box {
      max-width: 800px;
      margin: 1rem auto;
      text-align: center;
      font-size: 0.95rem;
      line-height: 1.6;
      color: #ccc;
      background: rgba(255,255,255,0.02);
      padding: 1.5rem;
      border-radius: 12px;
    }
    
    /* --- General Buttons --- */
    .btn {
      font-family: 'Segoe UI', sans-serif;
      font-weight: 700;
      white-space: nowrap;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-size: 0.85rem;
      background: linear-gradient(145deg, #555555, #2a2a2a);
      color: #e0e0e0;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    .btn:hover {
      background: linear-gradient(145deg, #656565, #333333);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    /* --- Beat List Layout --- */
    .beat-list {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      gap: 0.5rem; /* Reduced gap */
    }
    .beat-item {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      width: 100%;
      max-width: 700px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .beat-item.is-playing-card {
        animation: pulse-glow 2s infinite alternate;
    }
    .beat-item-play-btn {
        font-size: 1.5rem;
        color: #ddd;
        cursor: pointer;
        transition: color 0.2s ease;
    }
    .beat-item-play-btn:hover {
        color: #7e57c2;
    }
    .beat-item-title {
        flex-grow: 1;
        font-weight: 600;
    }
    .beat-item-price {
        font-weight: 700;
        color: #00ff99;
    }
    .beat-item-price.sold {
        color: #ff5555;
    }
    
    /* --- Sticky Player --- */
    #sticky-player {
        position: fixed;
        bottom: -100px;
        left: 0;
        width: 100%;
        background: #181818;
        border-top: 1px solid #333;
        padding: 0.5rem 1rem;
        display: grid;
        grid-template-columns: 1fr 2fr 1fr;
        align-items: center;
        gap: 1rem;
        z-index: 2000;
        transition: all 0.5s ease;
        -webkit-transform: translateZ(0); /* Mobile rendering fix */
        transform: translateZ(0);
    }
    #sticky-player.visible {
        bottom: 0;
    }
    #sticky-player.is-glowing {
        animation: pulse-glow 2s infinite alternate;
    }
    #sticky-player .track-info {
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #sticky-player .track-title {
        font-weight: bold;
        margin: 0;
    }
    #sticky-player .player-controls-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #sticky-player .custom-audio-player {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        max-width: 400px;
    }
    #sticky-player .play-pause-btn {
        background: linear-gradient(145deg, #d5d5d5, #a0a0a0);
        color: #111;
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
    }
    #sticky-player .progress-bar-container {
        flex-grow: 1;
        background: #444;
        border-radius: 10px;
        height: 8px;
        cursor: pointer;
        overflow: hidden;
    }
    #sticky-player .progress-bar {
        background: linear-gradient(90deg, #7e57c2, #42a5f5);
        width: 0%;
        height: 100%;
        border-radius: 10px;
        transition: box-shadow 0.3s ease;
    }
    #sticky-player .time-display {
        font-size: 0.85rem;
        color: #aaa;
        min-width: 100px;
        text-align: center;
    }


    /* --- Vibe Search Modal --- */
    .vibe-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(10px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .vibe-modal-overlay.visible {
        display: flex;
        opacity: 1;
    }
    .vibe-modal-content {
        position: relative;
        background: transparent;
        text-align: center;
        width: 90vw;
        height: 90vw;
        max-width: 600px;
        max-height: 600px;
        display: flex;
        justify-content: center;
        align-items: center;
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }
     #vibe-visualizer {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 100%;
        z-index: 0;
    }
    .vibe-text-wrapper {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .vibe-modal-overlay.visible .vibe-modal-content {
        transform: scale(1);
    }
    .vibe-modal-content h2 {
        margin-top: 0;
        font-family: 'Segoe UI', sans-serif;
    }
    .vibe-bubbles {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    .vibe-bubble {
        padding: 0.8rem 1.5rem;
        border-radius: 50px;
        border: 1px solid #555;
        background: #333;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        animation-name: float;
        animation-iteration-count: infinite;
        animation-direction: alternate;
        animation-timing-function: ease-in-out;
    }
    .vibe-bubble:hover {
        background: #7e57c2;
        transform: scale(1.1) translateY(-5px);
        border-color: #7e57c2;
        animation-play-state: paused;
    }
    .vibe-modal-close {
        position: absolute;
        top: 20px; 
        right: 20px;
        font-size: 2.5rem;
        color: #fff;
        cursor: pointer;
        font-weight: 300;
        transition: transform 0.3s ease;
        background: rgba(0,0,0,0.5);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        line-height: 1;
        z-index: 2;
    }
    .vibe-modal-close:hover {
        transform: rotate(90deg);
    }
    
    @keyframes float {
        0% {
            transform: translateY(0px);
        }
        100% {
            transform: translateY(-10px);
        }
    }
    
    @keyframes pulse-glow {
        0% {
            box-shadow: 0 0 5px rgba(126, 87, 194, 0.2), 0 0 10px rgba(66, 165, 245, 0.2);
            border-color: rgba(126, 87, 194, 0.5);
        }
        50% {
            box-shadow: 0 0 20px rgba(126, 87, 194, 0.6), 0 0 30px rgba(66, 165, 245, 0.4);
            border-color: rgba(66, 165, 245, 1);
        }
        100% {
            box-shadow: 0 0 5px rgba(126, 87, 194, 0.2), 0 0 10px rgba(66, 165, 245, 0.2);
            border-color: rgba(126, 87, 194, 0.5);
        }
    }

    @media (max-width: 768px) {
        body {
            padding-bottom: 0; /* Remove bottom padding on mobile */
            padding-top: 80px; /* Add top padding for the player */
        }
        #sticky-player {
            bottom: auto;
            top: -100px;
            border-top: none;
            border-bottom: 1px solid #333;
            transition: top 0.5s ease;
        }
        #sticky-player.visible {
            top: 0;
            bottom: auto;
        }
        #sticky-player {
            grid-template-columns: 1fr;
            padding: 0.5rem;
            gap: 0.5rem;
        }
        #sticky-player .track-info {
            display: none; /* Hide title on mobile for more space */
        }
        #sticky-player .player-controls-wrapper {
            order: 1;
        }
        #sticky-player .player-actions {
            display: none; /* Hide the empty spacer on mobile */
        }
        .vibe-modal-overlay {
            align-items: flex-start;
            padding-top: 15vh;
        }
    }
    @media (max-width: 600px) {
        .vibe-modal-content {
            padding: 1rem;
        }
    }

  </style>
</head>
<body>

<!-- Top Bar -->
<div class="top-bar">
  <div class="search-container">
    <input type="text" id="search-input" placeholder="Αναζήτηση με τίτλο ή tag...">
  </div>
  <button id="vibe-search-btn">Vibe Search</button>
</div>

<!-- Category Filter Buttons -->
<div class="category-filter">
  <button class="filter-btn active" data-category="all">Όλα</button>
  <button class="filter-btn" data-category="trap">Trap / Drill</button>
  <button class="filter-btn" data-category="boombap">Rap / Boombap</button>
  <button class="filter-btn" data-category="latin">Latin Urban / Afro</button>
  <button class="filter-btn" data-category="lofi">Lofi</button>
  <button class="filter-btn" data-category="custom">Custom</button>
  <button class="filter-btn" data-category="vault">Vault Beats</button>
  <button class="filter-btn" data-category="ai">AI Access</button>
</div>

<!-- Info Boxes... -->
<div class="info-box" id="aiInfoBox" style="display:none;">
  <button onclick="toggleAiDescription()" class="btn">Τι είναι το AI Access;</button>
  <div id="aiDescription" style="display:none; margin-top: 1rem;">Τα beats στην κατηγορία AI Access είναι δημιουργημένα μερικώς από εργαλεία τεχνητής νοημοσύνης. Η δομή και η μίξη έχει γίνει χειροποίητα από τον Vybezmadethis στο Vision Sound Studio.<br><br>Αυτή η κατηγορία αφορά αποκλειστικά leasing χρήση: δηλαδή μπορείς να χρησιμοποιήσεις το beat για προσωπικά ή εμπορικά projects χωρίς να αποκτήσεις την αποκλειστική του κυριότητα. Μπορεί να το χρησιμοποιούν και άλλοι, αλλά η χρήση σου είναι νόμιμη και επιτρεπτή για δημιουργία περιεχομένου.</div>
</div>
<div class="info-box" id="vaultInfoBox" style="display: none;">
  <button onclick="toggleVaultDescription()" class="btn">Τι είναι τα Vault Beats;</button>
  <div id="vaultDescription" style="display:none; margin-top: 1rem;">Τα Vault Beats είναι beats που δεν μπορούν πλέον να επεξεργαστούν περαιτέρω είτε επειδή έχουν χαθεί τα αρχικά projects είτε γιατί ήταν πειραματικά ή πρώιμα drafts.<br><br>Παρότι δεν είναι διαθέσιμα σε μορφή stems, και δεν υπάρχουν projects, έχει γίνει επεξεργασία πάνω τους και διατίθενται σε πιο προσιτή τιμή και διατηρούν την ενέργεια και το vibe τους για όσους ψάχνουν ιδιαίτερους ήχους με low budget.</div>
</div>
<div class="info-box" id="customInfoBox" style="display: none;">
    <p>Εδώ θα βρείτε δείγματα από custom παραγωγές που έχουν γίνει για άλλους καλλιτέχνες.</p>
    <p>Αν θέλεις το δικό σου μοναδικό beat, στείλε email στο <a href="mailto:studiovisionsound@gmail.com" style="color: #7e57c2;">studiovisionsound@gmail.com</a> με τις ιδέες σου ή επικοινώνησε στο <a href="https://www.instagram.com/visionsoundhub.gr" target="_blank" style="color: #7e57c2;">Instagram</a>.</p>
    <p style="margin-top: 1rem; font-weight: bold;">Η διαδικασία για custom beat ξεκινά από 100€, με την τελική τιμή να διαμορφώνεται ανάλογα με την πολυπλοκότητα.</p>
</div>
<div class="info-box" id="generalInfoBox" style="display: block;">
  <button onclick="toggleGeneralInfo()" class="btn">Χρήσιμες πληροφορίες</button>
  <div id="generalInfo" style="display:none; margin-top: 1rem;">Όλα τα beats (εκτός από την κατηγορία AI Access) δεν διατίθενται με leasing.<br>Οι αναγραφόμενες τιμές αφορούν την αγορά του beat σε μορφή MP3 και WAV.<br><br>Για παράδοση των stems, υπάρχει επιπλέον χρέωση (20€).<br><br>Όλα τα beats συνοδεύονται από σύντομο voice tag στην αρχή, ως στοιχείο branding του παραγωγού.<br><br>Ο αγοραστής αποκτά αποκλειστικά δικαιώματα χρήσης για τη συγκεκριμένη δημιουργία όχι την πλήρη κυριότητα. Ο δημιουργός μπορεί να το χρησιμοποιήσει σε δικά του projects (όπως instrumental ή release στις πλατφόρμες) αλλά δεν επιτρέπεται να το μεταπωλήσει σε άλλον καλλιτέχνη.</div>
</div>

<!-- Vibe Search Modal -->
<div class="vibe-modal-overlay" id="vibe-modal">
    <div class="vibe-modal-content" id="vibe-modal-content">
        <canvas id="vibe-visualizer"></canvas>
        <div class="vibe-text-wrapper">
            <span class="vibe-modal-close" id="vibe-modal-close">&times;</span>
            <h2>Πώς νιώθεις σήμερα;</h2>
            <p>Διάλεξε ένα vibe για να βρεις το κατάλληλο beat.</p>
            <div class="vibe-bubbles">
                <div class="vibe-bubble" data-vibe-tags="love,romantic,smooth">Ερωτευμένος</div>
                <div class="vibe-bubble" data-vibe-tags="sad,emotional,dark,melancholic">Μελαγχολικός</div>
                <div class="vibe-bubble" data-vibe-tags="aggressive,hard,drill">Θέλω να χώσω μπάρες</div>
                <div class="vibe-bubble" data-vibe-tags="chill,lofi,relax">Για χαλάρωση</div>
                <div class="vibe-bubble" data-vibe-tags="party,upbeat,dancehall">Για πάρτι</div>
                <div class="vibe-bubble" data-vibe-tags="epic,cinematic,storytelling">Κινηματογραφικό</div>
            </div>
        </div>
    </div>
</div>


<!-- This is where the beats will be rendered -->
<div class="beat-list" id="beatList"></div>

<!-- Sticky Player -->
<div id="sticky-player">
    <div class="track-info">
        <p class="track-title" id="sticky-player-title">Επίλεξε ένα beat</p>
    </div>
    <div class="player-controls-wrapper">
        <div class="custom-audio-player" id="main-player">
            <button class="play-pause-btn"><i class="fas fa-play"></i></button>
            <div class="progress-bar-container">
                <div class="progress-bar"></div>
            </div>
            <div class="time-display">0:00 / 0:00</div>
        </div>
    </div>
    <div class="player-actions"></div> <!-- Empty div for balance -->
    <audio id="main-audio-element" preload="metadata"></audio>
</div>


<script>
  // --- ΔΕΔΟΜΕΝΑ ΓΙΑ ΤΑ BEATS ΣΟΥ ---
  const beatsData = [
    {
      id: 5,
      title: 'Marios Beat (Custom Sample)',
      audioSrc: 'https://github.com/Visionsoundhub/vybezmadethis.beats/raw/refs/heads/main/Marios%20beat%20extended%2099BPM%20Eminor.mp3',
      price: null,
      status: 'available',
      category: 'custom',
      tags: ['custom', 'melodic', 'emotional', 'sad']
    },
    {
      id: 3,
      title: 'AI Experiment #1',
      audioSrc: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
      price: '15€',
      status: 'available',
      category: 'ai',
      tags: ['experimental', 'electronic', 'future']
    },
     {
      id: 4,
      title: 'Old Vault Sketch',
      audioSrc: '',
      price: '30€',
      status: 'sold',
      category: 'vault',
      tags: ['raw', 'draft', 'lofi-sketch']
    },
    {
      id: 6,
      title: 'Fire Bars',
      audioSrc: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
      price: '80€',
      status: 'available',
      category: 'trap',
      tags: ['aggressive', 'hard', 'drill']
    },
    {
      id: 7,
      title: 'Love Sunset',
      audioSrc: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',
      price: '80€',
      status: 'available',
      category: 'lofi',
      tags: ['love', 'romantic', 'smooth', 'chill']
    }
  ];

  // --- GLOBAL PLAYER STATE ---
  const beatListEl = document.getElementById('beatList');
  const searchInput = document.getElementById('search-input');
  const mainAudio = document.getElementById('main-audio-element');
  const stickyPlayer = document.getElementById('sticky-player');
  const stickyPlayerTitle = document.getElementById('sticky-player-title');
  let currentPlaylist = [];
  let currentTrackIndex = -1;

  // --- RENDER LOGIC ---
  function renderBeats(filter) {
    if (!beatListEl) return;
    beatListEl.innerHTML = '';

    let filteredBeats = beatsData;

    if (filter.type === 'category') {
        filteredBeats = filter.value === 'all'
            ? beatsData.filter(beat => beat.category !== 'ai' && beat.category !== 'custom')
            : beatsData.filter(beat => beat.category === filter.value);
    }
    if (filter.type === 'search') {
        filteredBeats = beatsData.filter(beat => {
            const titleMatch = beat.title.toLowerCase().includes(filter.value);
            const tagMatch = beat.tags.some(tag => tag.toLowerCase().includes(filter.value));
            return titleMatch || tagMatch;
        });
    }
    if (filter.type === 'vibe') {
        filteredBeats = beatsData.filter(beat => 
            beat.tags.some(tag => filter.value.includes(tag))
        );
    }
    
    currentPlaylist = filteredBeats; // Update the global playlist

    if (filteredBeats.length === 0) {
        beatListEl.innerHTML = '<p style="color: #888;">Δεν βρέθηκαν beats που να ταιριάζουν με την αναζήτησή σας.</p>';
        return;
    }

    filteredBeats.forEach((beat, index) => {
      const item = document.createElement('div');
      item.className = 'beat-item';
      item.dataset.beatId = beat.id;

      const priceHtml = beat.price ? `<div class="beat-item-price ${beat.status === 'sold' ? 'sold' : ''}">${beat.status === 'sold' ? 'SOLD' : beat.price}</div>` : '';

      item.innerHTML = `
        <i class="fas fa-play beat-item-play-btn" onclick="handleTracklistClick(${index})"></i>
        <div class="beat-item-title">${beat.title}</div>
        ${priceHtml}
        <button class="btn" onclick="event.stopPropagation(); showContactInfo('${beat.title}')">Ζήτα το</button>
      `;
      beatListEl.appendChild(item);
    });
    updatePlayingUI();
  }

  // --- PLAYER LOGIC ---
  function handleTracklistClick(index) {
    const track = currentPlaylist[index];
    if (!track) return;
    
    if (currentTrackIndex === index) {
        if (mainAudio.paused) {
            mainAudio.play();
        } else {
            mainAudio.pause();
        }
    } else {
        playTrack(index);
    }
  }

  function playTrack(index) {
    currentTrackIndex = index;
    const track = currentPlaylist[currentTrackIndex];
    if (!track || !track.audioSrc) return;
    
    mainAudio.src = track.audioSrc;
    mainAudio.play();
    stickyPlayerTitle.textContent = track.title;
    stickyPlayer.classList.add('visible');
  }

  function setupStickyPlayer() {
    const player = document.getElementById('main-player');
    const playPauseBtn = player.querySelector('.play-pause-btn i');
    const progressBar = player.querySelector('.progress-bar');
    const progressBarContainer = player.querySelector('.progress-bar-container');
    const timeDisplay = player.querySelector('.time-display');

    function formatTime(seconds) {
        if (isNaN(seconds) || seconds < 0) return "0:00";
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    }

    player.querySelector('.play-pause-btn').addEventListener('click', () => {
        if (mainAudio.paused) {
            mainAudio.play();
        } else {
            mainAudio.pause();
        }
    });

    mainAudio.addEventListener('play', () => {
        playPauseBtn.className = 'fas fa-pause';
        updatePlayingUI();
    });
    mainAudio.addEventListener('pause', () => {
        playPauseBtn.className = 'fas fa-play';
        updatePlayingUI();
    });
    mainAudio.addEventListener('ended', () => {
        // Optional: play next track
    });
    mainAudio.addEventListener('timeupdate', () => {
        const { currentTime, duration } = mainAudio;
        if (duration) {
            progressBar.style.width = `${(currentTime / duration) * 100}%`;
            timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        }
    });
    mainAudio.addEventListener('loadedmetadata', () => {
        if (mainAudio.duration) {
            timeDisplay.textContent = `0:00 / ${formatTime(mainAudio.duration)}`;
        }
    });
    progressBarContainer.addEventListener('click', (e) => {
        const width = progressBarContainer.clientWidth;
        const clickX = e.offsetX;
        if (mainAudio.duration) {
            mainAudio.currentTime = (clickX / width) * mainAudio.duration;
        }
    });
  }
  
  function updatePlayingUI() {
      document.querySelectorAll('.beat-item').forEach(item => {
          item.classList.remove('is-playing-card');
          const playBtn = item.querySelector('.beat-item-play-btn');
          if (playBtn) playBtn.className = 'fas fa-play beat-item-play-btn';
      });

      if (!mainAudio.paused && currentTrackIndex > -1 && currentPlaylist[currentTrackIndex]) {
          const playingBeat = currentPlaylist[currentTrackIndex];
          const currentItem = document.querySelector(`.beat-item[data-beat-id='${playingBeat.id}']`);
          if (currentItem) {
              currentItem.classList.add('is-playing-card');
              const playBtn = currentItem.querySelector('.beat-item-play-btn');
              if(playBtn) playBtn.className = 'fas fa-pause beat-item-play-btn';
          }
      }
  }
  
  function showContactInfo(title) {
      alert(`Για πληροφορίες σχετικά με το "${title}", στείλτε email στο studiovisionsound@gmail.com ή DM στο Instagram.`);
  }

  // --- TOGGLE FUNCTIONS FOR INFO BOXES ---
  function toggleAiDescription() {
    const desc = document.getElementById("aiDescription");
    if (desc) desc.style.display = desc.style.display === "none" ? "block" : "none";
  }
  function toggleVaultDescription() {
    const desc = document.getElementById("vaultDescription");
    if (desc) desc.style.display = desc.style.display === "none" ? "block" : "none";
  }
  function toggleGeneralInfo() {
    const desc = document.getElementById("generalInfo");
    if (desc) desc.style.display = desc.style.display === "none" ? "block" : "none";
  }

  // --- INITIALIZATION & EVENT LISTENERS ---
  document.addEventListener('DOMContentLoaded', function() {
      const categoryButtons = document.querySelectorAll('.filter-btn');
      const aiInfoBox = document.getElementById('aiInfoBox');
      const vaultInfoBox = document.getElementById('vaultInfoBox');
      const customInfoBox = document.getElementById('customInfoBox');
      const generalInfoBox = document.getElementById('generalInfoBox');

      categoryButtons.forEach(button => {
        button.addEventListener('click', () => {
          document.querySelector('.filter-btn.active')?.classList.remove('active');
          button.classList.add('active');
          const selectedCategory = button.getAttribute('data-category');
          searchInput.value = ''; 
          
          if (aiInfoBox) aiInfoBox.style.display = selectedCategory === 'ai' ? 'block' : 'none';
          if (vaultInfoBox) vaultInfoBox.style.display = selectedCategory === 'vault' ? 'block' : 'none';
          if (customInfoBox) customInfoBox.style.display = selectedCategory === 'custom' ? 'block' : 'none';
          if (generalInfoBox) generalInfoBox.style.display = (selectedCategory !== 'ai' && selectedCategory !== 'vault' && selectedCategory !== 'custom') ? 'block' : 'none';
          
          renderBeats({type: 'category', value: selectedCategory});
        });
      });
      
      searchInput.addEventListener('input', () => {
        const searchTerm = searchInput.value.toLowerCase().trim();
        document.querySelector('.filter-btn.active')?.classList.remove('active');
        renderBeats({type: 'search', value: searchTerm});
      });

      // Vibe Search Modal Logic
      const vibeBtn = document.getElementById('vibe-search-btn');
      const vibeModal = document.getElementById('vibe-modal');
      const vibeModalClose = document.getElementById('vibe-modal-close');
      const vibeBubbles = document.querySelectorAll('.vibe-bubble');
      const canvas = document.getElementById('vibe-visualizer');
      if (canvas) {
          const ctx = canvas.getContext('2d');
          let animationFrameId;

          function resizeCanvas() {
              const container = document.getElementById('vibe-modal-content');
              if (!container) return; // Guard clause
              const size = Math.min(container.clientWidth, container.clientHeight);
              canvas.width = size;
              canvas.height = size;
          }

          function drawVisualizer() {
              const radius = canvas.width / 3; // Base radius
              const points = 128;
              const centerX = canvas.width / 2;
              const centerY = canvas.height / 2;
              const time = Date.now() * 0.0005;

              ctx.clearRect(0, 0, canvas.width, canvas.height);
              ctx.beginPath();
              
              for (let i = 0; i <= points; i++) {
                  const angle = (i / points) * Math.PI * 2;
                  const wave = Math.sin(time + i * 0.5) * 10; // Wave amplitude
                  const pulse = (Math.sin(time * 2) + 1) / 2 * 15; // Pulsing amplitude
                  const currentRadius = radius + wave + pulse;
                  
                  const x = centerX + Math.cos(angle) * currentRadius;
                  const y = centerY + Math.sin(angle) * currentRadius;

                  if (i === 0) {
                      ctx.moveTo(x, y);
                  } else {
                      ctx.lineTo(x, y);
                  }
              }
              
              const gradient = ctx.createRadialGradient(centerX, centerY, radius - 20, centerX, centerY, radius + 20);
              gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
              gradient.addColorStop(0.5, 'rgba(200, 200, 255, 0.8)');
              gradient.addColorStop(1, 'rgba(126, 87, 194, 0)');

              ctx.strokeStyle = gradient;
              ctx.lineWidth = 2;
              ctx.stroke();
              ctx.shadowColor = 'rgba(200, 200, 255, 0.8)';
              ctx.shadowBlur = 15;
              ctx.stroke();
              ctx.shadowBlur = 0;


              animationFrameId = requestAnimationFrame(drawVisualizer);
          }


          vibeBtn.addEventListener('click', () => {
              vibeModal.classList.add('visible');
              resizeCanvas();
              if (animationFrameId) cancelAnimationFrame(animationFrameId);
              drawVisualizer();
          });

          vibeModalClose.addEventListener('click', () => {
              vibeModal.classList.remove('visible');
              cancelAnimationFrame(animationFrameId);
          });
          
          vibeModal.addEventListener('click', (e) => {
              if (e.target === vibeModal) {
                  vibeModal.classList.remove('visible');
                  cancelAnimationFrame(animationFrameId);
              }
          });
          window.addEventListener('resize', resizeCanvas);
      }


      vibeBubbles.forEach(bubble => {
          const duration = Math.random() * 2 + 3;
          const delay = Math.random() * 2;
          bubble.style.animationDuration = `${duration}s`;
          bubble.style.animationDelay = `-${delay}s`;

          bubble.addEventListener('click', () => {
              const tags = bubble.dataset.vibeTags.split(',');
              searchInput.value = '';
              document.querySelector('.filter-btn.active')?.classList.remove('active');
              renderBeats({type: 'vibe', value: tags});
              vibeModal.classList.remove('visible');
              if (animationFrameId) cancelAnimationFrame(animationFrameId);
          });
      });

      // Initial Setup
      renderBeats({type: 'category', value: 'all'});
      setupStickyPlayer();
  });
</script>
</body>
</html>
